<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Massage Conditions</title>
  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: #f7f9fb;
      color: #222;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: #1a3454;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    header h1 {
      font-size: 20px;
      margin: 0;
    }

    select {
      padding: 8px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      outline: none;
    }

    .container {
      max-width: 1000px;
      margin: 20px auto;
      padding: 0 16px;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .card h2 {
      margin: 0 0 10px;
      font-size: 22px;
      color: #1a3454;
    }

    .section-title {
      font-weight: 600;
      margin-top: 15px;
      border-bottom: 2px solid #CEE0F3;
      display: inline-block;
      padding-bottom: 4px;
      font-size: 15px;
      color: #444;
    }

    .list-block {
      margin: 6px 0;
      padding-left: 10px;
      border-left: 3px solid #eee;
    }

    .list-block div {
      padding: 6px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .list-block div:last-child {
      border-bottom: none;
    }

    img.condition-img {
      max-width: 100%;
      border-radius: 10px;
      margin: 12px 0;
    }
  </style>
</head>
<body>

<header>
  <h1>Massage Conditions</h1>
  <select id="conditionSelect">
    <option value="">Select Condition</option>
  </select>
</header>

<div class="container" id="cardsContainer"></div>

<script>
  const SUPABASE_URL = "https://nkjxlwuextxzpeohutxz.supabase.co/rest/v1";
  const SUPABASE_API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ranhsd3VleHR4enBlb2h1dHh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzMTI5MDQsImV4cCI6MjA0Nzg4ODkwNH0.S3qHT3l4FDV5T0uPI8q4SDo6O-87ApDILE2OTsWLg_0";
  const TABLE = "massage";

  const cardsContainer = document.getElementById("cardsContainer");
  const conditionSelect = document.getElementById("conditionSelect");

  async function fetchConditions() {
    const res = await fetch(`${SUPABASE_URL}/${TABLE}?select=*`, {
      headers: { apikey: SUPABASE_API_KEY, Authorization: `Bearer ${SUPABASE_API_KEY}` }
    });
    let data = await res.json();
    
    // Sort alphabetically by condition name
    data.sort((a, b) => (a.condition || "").localeCompare(b.condition || ""));
    return data;
  }

  function renderCard(cond) {
    const techniques = (cond.best_technique || "").split("\n").filter(Boolean);
    const contraindications = (cond.contraindication || "").split("\n").filter(Boolean);

    return `
      <div class="card">
        <h2>${cond.condition || "Unnamed Condition"}</h2>
        ${cond.image_url ? `<img src="${cond.image_url}" alt="${cond.condition}" class="condition-img">` : ""}

        <div>
          <span class="section-title">Definition:</span>
          <p>${cond.definition || "N/A"}</p>
        </div>

        <div>
          <span class="section-title">Best Technique:</span>
          <div class="list-block">
            ${techniques.length ? techniques.map(t => `<div>${t}</div>`).join("") : "<div>N/A</div>"}
          </div>
        </div>

        <div>
          <span class="section-title">Contraindications:</span>
          <div class="list-block">
            ${contraindications.length ? contraindications.map(c => `<div>${c}</div>`).join("") : "<div>N/A</div>"}
          </div>
        </div>
      </div>
    `;
  }

  async function renderAll() {
    const conditions = await fetchConditions();

    // Populate dropdown
    conditions.forEach(cond => {
      const opt = document.createElement("option");
      opt.value = cond.condition;
      opt.textContent = cond.condition;
      conditionSelect.appendChild(opt);
    });

    // Default load all
    cardsContainer.innerHTML = conditions.map(renderCard).join("");

    // On dropdown change â†’ show single card
    conditionSelect.addEventListener("change", e => {
      const value = e.target.value;
      if (!value) {
        cardsContainer.innerHTML = conditions.map(renderCard).join("");
      } else {
        const selected = conditions.find(c => c.condition === value);
        cardsContainer.innerHTML = renderCard(selected);
      }
    });
  }

  renderAll();
</script>
</body>
</html>
